/*! iot-board 2015-11-06 */
!function(a){"use strict";if(!a.Base64){var b,c="2.1.1";"undefined"!=typeof module&&module.exports&&(b=require("buffer").Buffer);var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a.charAt(c)]=c;return b}(d),f=String.fromCharCode,g=function(a){if(a.length<2){var b=a.charCodeAt(0);return 128>b?a:2048>b?f(192|b>>>6)+f(128|63&b):f(224|b>>>12&15)+f(128|b>>>6&63)+f(128|63&b)}var b=65536+1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320);return f(240|b>>>18&7)+f(128|b>>>12&63)+f(128|b>>>6&63)+f(128|63&b)},h=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,i=function(a){return a.replace(h,g)},j=function(a){var b=[0,2,1][a.length%3],c=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),e=[d.charAt(c>>>18),d.charAt(c>>>12&63),b>=2?"=":d.charAt(c>>>6&63),b>=1?"=":d.charAt(63&c)];return e.join("")},k=a.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,j)},l=b?function(a){return q(new b(a).toString("base64"))}:function(a){return q(k(i(a)))},m=function(a,b){return b?l(a).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}).replace(/=/g,""):l(a)},n=function(a){return m(a,!0)},o=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),p=function(a){switch(a.length){case 4:var b=(7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3),c=b-65536;return f((c>>>10)+55296)+f((1023&c)+56320);case 3:return f((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return f((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},q=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},r=function(a){var b,c,d,e="",f=0;for(b=c=d=0;f<a.length;)b=a.charCodeAt(f),128>b?(e+=String.fromCharCode(b),f++):b>191&&224>b?(d=a.charCodeAt(f+1),e+=String.fromCharCode((31&b)<<6|63&d),f+=2):(d=a.charCodeAt(f+1),c3=a.charCodeAt(f+2),e+=String.fromCharCode((15&b)<<12|(63&d)<<6|63&c3),f+=3);return e},s=function(a){return a.replace(o,p)},t=function(a){var b=a.length,c=b%4,d=(b>0?e[a.charAt(0)]<<18:0)|(b>1?e[a.charAt(1)]<<12:0)|(b>2?e[a.charAt(2)]<<6:0)|(b>3?e[a.charAt(3)]:0),g=[f(d>>>16),f(d>>>8&255),f(255&d)];return g.length-=[0,0,2,1][c],g.join("")},u=a.atob||function(a){return a.replace(/[\s\S]{1,4}/g,t)},v=b?function(a){return new b(a,"base64").toString()}:function(a){return s(u(a))},w=function(a){return a=r(a),v(a.replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};if(a.Base64={VERSION:c,atob:u,btoa:k,fromBase64:w,toBase64:m,utob:i,encode:m,encodeURI:n,btou:s,decode:w},"function"==typeof Object.defineProperty){var x=function(a){return{value:a,enumerable:!1,writable:!0,configurable:!0}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",x(function(){return w(this)})),Object.defineProperty(String.prototype,"toBase64",x(function(a){return m(this,a)})),Object.defineProperty(String.prototype,"toBase64URI",x(function(){return m(this,!0)}))}}}}(this),window.initFreeIOTJSBridge=function(){function a(a){console.log("createQueueReadyIframe..."),k=a.createElement("iframe"),k.style.display="none",a.documentElement.appendChild(k)}function b(a){PandoJSBridge._messageHandler||(PandoJSBridge._messageHandler=a,j&&console.log("init... "))}function c(){var a=navigator.userAgent.toLowerCase();return a.indexOf("android")>-1}function d(){var a=navigator.userAgent.toLowerCase();return a.indexOf("iphone")>-1||a.indexOf("ios")>-1}function e(a,b){h({data:a},b)}function f(a,b){m[a]=b}function g(a,b,c){h({handlerName:a,data:b},c)}function h(a,b){if(b){var e="cb_"+p++ +"_"+(new Date).getTime();o[e]=b,a.callbackId=e}l.push(a);var f=Base64.encode(JSON.stringify(l));l=[];var g=n+"://invoke/"+f;j&&console.log(g),d()?k.src=g:c()?alert(encodeURI(g)):k.src=g}function i(a){j&&console.log("handleMessageFromNative..."+a),setTimeout(function(){j&&console.log(a),a=Base64.decode(a);var b=JSON.parse(a);if(j&&console.log("message.responseId =>"+b.responseId),b.responseId){var c=o[b.responseId];if(!c)return;c(b.responseData),delete o[b.responseId]}},0)}var j=!1;if(!window.PandoJSBridge){var k,l=[],m={},n="pando",o={},p=1;window.OnPandoJSBridgeReady=function(a){window.PandoJSBridge?(console.log("has PandoJSBridge..."),a(PandoJSBridge)):(console.log("PandoJSBridge not init..."),document.addEventListener("PandoJSBridgeReady",function(){a(PandoJSBridge)},!1))},window.PandoJSBridge={init:b,send:e,registerHandler:f,callHandler:g,_handleMessageFromNative:i};var q=document;a(q);var r=q.createEvent("Events");r.initEvent("PandoJSBridgeReady"),r.bridge=PandoJSBridge,q.dispatchEvent(r),window.pando={},window.pando.getDeviceStatus=function(a){g("currentStatus",{},a)},window.pando.sendCommand=function(a,b){g("sendCommand",a,b)},window.pando.getCurrentStatus=function(a){g("getCurrentStatus",{},a)},window.pando.setCurrentStatus=function(a){g("setCurrentStatus",data,a)}}},window.initFreeIOTWechat=function(){function a(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c&&c.length>1?c[2]:null}var b=a("identifier"),c=function(a){$.ajax({url:"http://freeiot.pandocloud.com/api/device/status/current?identifier="+b,crossDomain:!0,type:"get",success:function(b){console.log(b),a(b)}})},d=function(a,c){$.ajax({type:"post",url:"http://freeiot.pandocloud.com/api/device/status/current?identifier="+b,crossDomain:!0,data:JSON.stringify(a),contentType:"application/json",success:function(a){console.log(a),c(a)}})};window.pando={},window.pando.getCurrentStatus=function(a){c(a)},window.pando.setCurrentStatus=function(a,b){d(a,b)}},!function(){function a(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c&&c.length>1?c[2]:null}function b(){d.getStatusPending=!1,d.getStatusQueue=[]}function c(a,c){var e=d.getStatusQueue;d.getStatusPending?e.push({label:a,callback:c}):(d.getStatusPending=!0,e.push({label:a,callback:c}),window.pando.getCurrentStatus(function(a){if(0!=a.code)return alert(a.msg),b();for(var c=a.data,d=0;d<e.length;d++)e[d].callback(c[e[d].label]);b()}))}if(!window.iotboard)return void console.log("iotboard not initialized!");"wechat"==a("from")||"ide"==a("from")?window.initFreeIOTWechat():window.initFreeIOTJSBridge();var d={getStatusPending:!1,getStatusQueue:[]};d.onWidgetStatusChanged=function(a,b,c){var d={};d[b]=c,window.pando.setCurrentStatus(d,function(a){console.log("responseData: "+a),0!=a.code&&alert(a.msg)})},d.getCurrentStatus=function(a,b,d){c(b,d)},window.iotboard.setModel(d)}();